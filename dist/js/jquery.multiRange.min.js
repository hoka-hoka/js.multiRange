"use strict";!function(t){class e{constructor(){this.listeners={}}on(t,e){this.listeners[t]=(this.listeners[t]||[]).concat(e)}off(t,e){this.listeners[t]=(this.listeners[t]||[]).filter(t=>t!==e)}emit(t,e){(this.listeners[t]||[]).forEach((function(t){t(e)}))}}class i extends e{constructor(e){super(),this.thumb=t('<div class="thumb">'),this.popup=!1,this.direction=3,this.valueHight=0,this.valueLow=0,this._options=e,Object.keys(e).forEach(t=>{this._options[t]=e[t]}),this.current=this._options.range,t(this.current).is('input.range[type="range"]')||t.error('Плагин неверно инициализирован (прим. <input type="range" class=range>')}init(){let e=this.current.getAttribute("value"),i=null===e?[]:e.split(","),s=t(this.current);if(this.hasProperty("multirange","multirange")){this.ghost=s.clone().addClass("ghost"),s=s.addClass("basic");const e=this._options.min+(this._options.max-this._options.min)/2;s.attr("value",i[0]||e),this.ghost.attr("value",t.trim(i[1])||e),this.emit("addElement",{current:s,add:[this.ghost,this.thumb]})}else s=s.addClass("basic"),this.emit("addElement",{current:s,add:[this.thumb]});this.Direction=["left","right"],this.popup=this.Popup(!0),this.Rotate(!0),this.Scale(!0),this.emit("moveRange",{}),this.followProperty(),this.updateProperty()}hasProperty(e,i){const s=t(this.current).data(e),a=this._options[e];return~t.inArray(i,[s,a])}set Direction(e){t.map(e,t=>{this.hasProperty("multirange","multirange")?this.direction=1:this.hasProperty("direction",t)&&"left"===t&&(this.direction=2)})}get Direction(){let e=t(this._options.range);switch(this.direction){case 1:if(this.ghost)return[Math.min(e.val(),this.ghost.val()),Math.max(e.val(),this.ghost.val())];throw new Error("не найден ghost");case 2:return[e.val(),100];default:return[0,e.val()]}}Popup(e){if(this.hasProperty("popup",e)){let e=t('<div class="popup"><span></span><div class="arrow"></div>');if(this.ghost){let t=e.clone(!0);this.emit("addElement",{current:this.thumb,add:[e,t],method:"append"})}else this.emit("addElement",{current:this.thumb,add:[e],method:"append"});return!0}return!1}Rotate(e){if(this.hasProperty("rotate",e)){let e=t(this._options.range).parent();this.emit("addClass",{element:e,add:"rotate--90"})}}Scale(e){let i=t(this._options.range).parent();if(this.hasProperty("scale",e)){let e=0,s=(this._options.max-this._options.min)/10,a=t('<ul class="scale"></ul>');for(;e<=10;)a.append(`<li class="scale__item">${+this._options.min+s*e}</li>`),++e;i.append(a),this.emit("addElement",{current:i,add:[i]})}}followProperty(){this.valueLow=this.Direction[0],this.valueHight=this.Direction[1]}updateProperty(){const e=t=>(t-this._options.min)/(this._options.max-this._options.min)*100+"%",i=t=>this._options.toffeeSize*(t-this._options.min)/(this._options.max-this._options.min),s=t=>this._options.toffeeSize*(this._options.max-t)/(this._options.max-this._options.min);const a=[...function*(){for(var t=0;t<2;t++)t?yield`${e(this.valueHight)} + ${s(this.valueHight)}px`:yield`${e(this.valueLow)} - ${i(this.valueLow)}px`}.call(this)];this.emit("updateRange",{el:this.thumb,pos:a}),this.popup&&this.emit("updatePopup",{el:t(this.thumb).children()})}}class s extends e{constructor(e){super(),this._model=e,t(e._options.range).wrap('<div class="multirange"></div>');let i=t(e._options.range).height();i&&t(e._options.range).parent().height(i)}addElement({current:t,add:e,method:i="after"}){t[i](e)}addClass({element:t,add:e}){t.addClass(e)}updateRange(t){t.el.css("--start","calc("+t.pos[0]+")"),t.el.css("--stop","calc("+t.pos[1]+")")}updatePopup(t,e){t.innerHTML=e}}class a extends e{constructor(t,e){super(),this._model=t,this._view=e,this._model.on("addElement",t=>this.addElement(t)),this._model.on("addClass",t=>this.addClass(t)),this._model.on("moveRange",()=>this.moveRange()),this._model.on("updateRange",t=>this.updateRange(t)),this._model.on("updatePopup",t=>this.updatePopup(t))}addElement(e){Array.isArray(e.add)?t.each(e.add,(t,i)=>{this._view.addElement({current:e.current,add:e.add[t],method:e.method})}):this._view.addElement(e)}addClass(t){this._view.addClass({element:t.element,add:t.add})}moveRange(){let e=t(this._model._options.range);e.add(e.siblings(".ghost")).on("input",t=>{this._model.followProperty(),t.stopPropagation(),this._model.updateProperty()})}updateRange(t){this._view.updateRange(t)}updatePopup(e){let i=function*(){return yield this._model.valueLow.toString(),this._model.valueHight.toString()}.call(this);3===this._model.direction&&(i.next(),this._view.addClass({element:e.el,add:"right--0"})),e.el.each((e,s)=>{this._view.updatePopup(t(s).children()[0],i.next().value)})}}t.fn.multiRange=Object.assign((function(e){return t.each(this,(function(o,n){let r={range:n,min:t(this).attr("min")||0,max:t(this).attr("max")||100};t(this).data("controller")&&t.error("Плагин уже был инициализирован"),Object.keys(e).forEach(e=>{t.fn.multiRange.propertys.hasOwnProperty(e)||t.error("Передаваемого свойства "+e+" не существует")});let h=t.extend(r,t.fn.multiRange.propertys,e);const l=new i(h),d=new s(l),p=new a(l,d);l.init(),t(this).data("controller",p)})),this}),{propertys:{toffeeSize:0,multirange:!1,popup:!1,scale:!1,direction:"right"}})}(jQuery);
//# sourceMappingURL=jquery.multiRange.min.js.map